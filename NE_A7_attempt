---
title: "ESM232- HW7"
author: "Anna Abelman, Nathalie Eegholm, Claudia Flores "
date: "5/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sensitivity)
library(ggplot2)
```

#Rabbits & Hawks, Assignment 7:

A small city with a large urban park has decided to introduce a rare species of rabbits into this park - Rabbits are cute and the kids love them, and giving a rare species a new home sounds like a good idea. The urban park manager is concerned about how this rabbit population might grow over the next few decades. Rabbits have no natural predators in the region where the park is situated. The manager would like to know, approximately, how many rabbits there will be 20 years from now if the rabbits are introduced as planned. The manager reviewed the literature and found the following estimates for survival and fertility rates for the rare rabbit population, for 4 different age classes. The estimates for these rates are shown below:

#Fertility (rabbit/female)
Young (age 0-1): 0
Sub-Adults (age 1-2): 2
Adult (age 2-3): 6
Aged (age 3-4): 1

#Survivability (male and female)
Young (age 0-1): 0.8
Sub-Adults (age 1-2): 0.85
Adult (age 2-3): 0.65
Aged (age 3-4): 0.1


# Part 1
Using a matrix population model approach answer the following questions for the manager:

Assume that we start with 10 adult rabbits. (group 3)

What is the total rabbit population after 20 years?

How many young rabbits (first age class) are there in the population at that time?


```{r}

fert =  c(0/2,2/2,6/2,1/2) #divide fertility (just for females) by 2
surv=c(0.8,0.85, 0.65, 0.1) #survivability 

source("/Users/neegholm/Documents/ESM232_S21/Rmaterials_May13/evolve_pop.R")
evolve_pop

ini = c(0,0,10,0) #start with 10 adult rabbits
nyr=21 #number of years to run 
rabbit_pop=evolve_pop(fert, surv, ini, nyr) #run evolve_pop.R

# note: from the code from class, the rabbit_pop at t=1 was giving 0 instead of 10, so I had to account for this in lines 57 and 62 when creating the dataframes

yr = seq(from=1, to=nyr) #sequence of years
rabbit_tot = cbind.data.frame(yr=seq(from=1,to=20,by=1), poptot=(rabbit_pop$poptot[2:21]))
ggplot(rabbit_tot, aes(yr, poptot))+geom_col(fill="mediumpurple2")+labs(y="Total Rabbit Population", x="Year")


# plot information about ages
rabbit_ages = cbind.data.frame(yr=seq(from=1,to=20,by=1), t(rabbit_pop$popbyage[,1:20]))
rabbit_agesl = rabbit_ages %>% gather(key="agecat", value="pop",-yr)
ggplot(rabbit_agesl, aes(yr, pop, fill=agecat))+geom_col()+labs(y="Population", fill="Age Group")


#What is the total rabbit population after 20 years?
rabbit_tot$poptot[20]

#How many young rabbits (first age class) are there in the population at that time?
rabbit_ages$`1`[20]

```

# progress so far, just need to do the Sobol sensitivity analysis
